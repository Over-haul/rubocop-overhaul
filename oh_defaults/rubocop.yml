inherit_mode:
  merge:
  - Exclude
  - Include

AllCops:
  NewCops: enable
  Exclude:
    - public/**/*
    - '**/db/schema.rb'
    - '**/db/migrate/2020*'
    - '**/db/migrate/2021*'
    - '**/db/migrate/2022*'
    - '**/db/migrate/2023*'

Bundler/GemComment:
  Enabled: true
  OnlyFor:
    - restrictive_version_specifiers
    - github

Layout/ArgumentAlignment:
  EnforcedStyle: with_fixed_indentation

Layout/CaseIndentation:
  EnforcedStyle: end

Layout/EndAlignment:
  EnforcedStyleAlignWith: variable

Layout/FirstArgumentIndentation:
  EnforcedStyle: consistent

Layout/FirstArrayElementIndentation:
  EnforcedStyle: consistent

Layout/FirstMethodArgumentLineBreak:
  Enabled: true
  Exclude:
    - spec/**/*.rb
    - test/**/*.rb

Layout/IndentationConsistency:
  EnforcedStyle: indented_internal_methods

# Allow long comments generated by annotate (related to database indexes)
Layout/LineLength:
  AllowedPatterns:
    - '\A#  (?:index|idx)_'

Layout/MultilineAssignmentLayout:
  Enabled: true
  EnforcedStyle: same_line

Style/MultilineBlockChain:
  Enabled: false

Layout/MultilineMethodCallBraceLayout:
  EnforcedStyle: new_line
  Exclude:
    - spec/**/*.rb
    - test/**/*.rb

Layout/MultilineMethodCallIndentation:
  EnforcedStyle: indented

Layout/MultilineOperationIndentation:
  EnforcedStyle: indented

# Incompatible with RSpec idioms
# https://github.com/rubocop/rubocop/issues/4222
Lint/AmbiguousBlockAssociation:
  Exclude:
    - spec/**/*

Lint/AssignmentInCondition:
  Enabled: false

Lint/UnderscorePrefixedVariableName:
  AllowKeywordBlockArguments: true
  Exclude:
    - app/concepts/**/*

# Because of Trailglazer custom `#fail`, there's a lot of false-positives on this cop
Lint/UnreachableCode:
  Exclude:
    - app/concepts/**/operation/**/*
    - app/concepts/**/operations/*

Metrics/AbcSize:
  Max: 35

Metrics/BlockLength:
  Enabled: false

Metrics/ClassLength:
  Exclude:
    - spec/**/*.rb

Metrics/CyclomaticComplexity:
  Max: 15

Metrics/PerceivedComplexity:
  Max: 20

Metrics/MethodLength:
  Max: 15
  CountAsOne: ['array', 'heredoc', 'hash']

Naming/BlockForwarding:
  Enabled: true
  EnforcedStyle: explicit

Naming/VariableNumber:
  EnforcedStyle: snake_case
  AllowedIdentifiers:
    - capture3
    - rfc1123_date
    - rfc822
    - rfc2822
    - rfc3339
    - x86_64
    - iso8601
    - iso2
    - base64
    - t42
    - html5
    - e164
    - s3
    - r2
  Exclude:
    - '**/config/routes.rb'

Style/ArgumentsForwarding:
  UseAnonymousForwarding: false

Style/BlockComments:
  Enabled: false

Style/BlockDelimiters:
  AllowedMethods:
    - lambda
    - proc

Style/Documentation:
  Enabled: false

Style/FormatStringToken:
  EnforcedStyle: template

Style/FrozenStringLiteralComment:
  Exclude:
    - '**/db/migrate/*'

Style/HashSyntax:
  EnforcedShorthandSyntax: never

# can I remove?
Style/IfUnlessModifier:
  Enabled: false

Style/Lambda:
  EnforcedStyle: literal

Style/LambdaCall:
  EnforcedStyle: braces

Style/NegatedIf:
  Enabled: false

# can I remove it?
Style/NumericPredicate:
  Enabled: false

Style/ParallelAssignment:
  Enabled: false

# Populators and contracts make frequent use of `instance_exec` with `self`
Style/RedundantSelf:
  Exclude:
    - app/concepts/**/populators/**/*
    - app/concepts/**/contract/**/*

# Trailblazer defines `#fail` on a custom DSL
Style/SignalException:
  Exclude:
    - app/concepts/**/operation/**/*
    - app/concepts/**/operations/*

Style/StringLiterals:
  EnforcedStyle: double_quotes

Style/StringLiteralsInInterpolation:
  EnforcedStyle: double_quotes

Style/SymbolProc:
  AllowMethodsWithArguments: true

Style/FetchEnvVar:
  Enabled: false
